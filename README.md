# 신용카드 이상거래 탐지 머신러닝 모델 

코드스테이츠 AIB section2 프로젝트

[결과 PPT](https://github.com/hajinjo/AIB_project1-2/blob/main/sc2_ppt.pdf)

## ✔️ 개요

### 주제 선정

- 이상거래 탐지는 정상거래보다 이상거래가 압도적으로 적은 불균형 데이터를 사용한다. 불균형 데이터는 어떻게 접근하는지 공부하고 앞으로 비슷하게 차이가 많이나는 분류모델에도 동일한 방법을 사용할 수 있을지 알아보기 위해 이 주제를 선정했다.

### 데이터셋

- 캐글에서 받은 신용카드 fraud detection 데이터
- time, amount 컬럼을 빼고 나머지 특성들은 개인정보 보호차원에서 PCA로 축소되어있고 컬럼명도 임의로 붙여놓은 형태
- 총 30개의 feature, 약 28만개의 데이터

### 문제 정의 및 목표

- 정상, 이상 거래를 분류하는 이진분류로 **이상 거래를 잘 탐지**하는 모델을 만드는 것이 목적
    
<img width="650" alt="스크린샷 2022-06-15 오후 8 16 46" src="https://user-images.githubusercontent.com/83392231/175846030-aca4edbd-c501-4a5b-8e2e-71ee416de94d.png">
    
- 해당 데이터는 class 분포 차이가 많이나는 불균형 데이터
- 사기탐지가 목표이므로 정밀도보다 **재현율**에 초점을 맞춰서 모델을 만들고자 한다.
    - 재현율 : 실제로 사기 인것 중에 모델이 사기라고 올바르게 탐지한 비율

## ✔️ 프로젝트 진행

### 1) EDA

- time, amount 컬럼을 봤을 때 값의 범위가 달라서 스케일러를 사용해 범위를 줄여주는 작업 거침
- shap로 중요도가 높은 컬럼을 찾아서 하위 열개 컬럼은 삭제
- 중요도가 높게 나온 컬럼들의 타겟 분포도를 살펴보았더니 각 클래스의 분포 차이가 많이나서 영향력이 높은 피쳐라고 나온 것으로 보였다
    
<img width="287" alt="Untitled" src="https://user-images.githubusercontent.com/83392231/175846038-53127a6a-8e7f-4d6e-990d-2d7980be322f.png">

- 중요도 높은 피쳐 위주로 outlier를 찾아서 삭제
    
<img width="325" alt="스크린샷 2022-06-15 오후 8 27 04" src="https://user-images.githubusercontent.com/83392231/175846032-d7ee13b9-6eb7-4f9e-a778-e1542bab0e46.png">
    
    

### 2) 다운&업샘플링

클래스 불균형을 해소하기 위해 다운샘플링과 업샘플링을 시도

- **다운 샘플링**
    - 타겟 데이터를 적은 쪽 클래스 개수에 맞춰서 사용하는 방식으로 데이터 개수가 너무 줄어들어서 유의미한 결과를 내기 힘들다고 판단해 사용하지 않았다
- **업샘플림**
    - **SMOTE** 방법을 사용, 소수 클래스를 똑같이 복사해 개수를 늘리면 과적합이 발생하기 쉬우므로 소수 데이터에서 knn 방식으로 가상의 데이터를 생성하는 방법

### 3) 모델 학습

- 업샘플링 후 이진분류에 사용하는 로지스틱, 결정트리, Xgboost 모델을 사용해 각 모델의 성능 비교
- 검증 시 5번의 cross validation을 이용
- 하이퍼 파라미터 튜닝을 시도해봤지만 스코어에 크게 변동이 없었음
- 결정트리와 XGboost는 max deapth를 조절해보아도 훈련 스코어가 100에 검증 스코어는 로지스틱보다 낮아서 과적합이 발생했다고 판단

### 4) 평가

- 정확도는 98에 재현율도 91로 높지만 f1 score는 0.13, 정밀도가 0.07로 사기가 아닌 것도 대부분 사기라고 판별하는 상황
    
<img width="530" alt="스크린샷 2022-06-15 오후 8 48 56" src="https://user-images.githubusercontent.com/83392231/175846035-a6bef370-a25c-4acc-941c-ede4ebb3f32a.png">
    

- 조화 평균인 f1 score를 기준으로 두고 임계값을 탐색 했을때 재현율과 정밀도에서 더 좋은 성능을 보여준 **로지스틱** 모델을 최종 선정

## ✔️프로젝트 결과

- 로지스틱을 사용해 임계값 0.999 일때 재현율 83% f1-score 81% 인 모델을 만듦
    
<img width="534" alt="스크린샷 2022-06-15 오후 8 52 36" src="https://user-images.githubusercontent.com/83392231/175846036-906d834a-a074-452e-94b6-00dd1e633f79.png">
    
- 훈련시에는 업샘플링으로 분포를 맞춰주기 때문에 정확도가 상당히 높게 나오지만 테스트 상황에서는 분포가 다르기 때문에 점수가 확연히 낮아진다
- 재현율을 아예 100%로 만들 수 도 있었지만 그랬을때 정밀도와 정확도가 너무 많이 하락해서 쓸모없는 모델이 나왔다
- 정밀도도 너무 낮다면 정상거래를 사기로 인식해서 제재가 들어갔을때, 고객들의 불편과 불만이 쌓일 수 있어 득실을 고려해 적절하게 비율을 조절해야 한다

## ✔️느낀점

- 개인정보 때문에 피쳐 이름이 가려져 있어서 어떤 피쳐가 어떻게 영향을 주는지 더 자세한 EDA를 하지 못한 점이 아쉽다
- 실제로는 실시간으로 거래가 이루어지기 때문에 실시간 데이터를 받아 새로운 이상 패턴을 빨리 캐치해 사기탐지를 하는 것이 중요하다
